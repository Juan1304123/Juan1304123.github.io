<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORMULARIOS - Sistema</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>c
        body {
            background-color: #f8f9fa;
        }
        .form-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        @media (max-width: 767px) {
            .form-container {
                padding: 10px;
            }
            h1 {
                font-size: 1.5rem;
            }
            .nav-tabs .nav-link {
                padding: 0.5rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8 form-container">
                <h1 class="text-center mb-4 text-primary">FORMULARIOS</h1>
                <nav>
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="registro-tab" data-bs-toggle="tab" data-bs-target="#registro" type="button" role="tab" aria-controls="registro" aria-selected="true">Registro</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="modificar-tab" data-bs-toggle="tab" data-bs-target="#modificar" type="button" role="tab" aria-controls="modificar" aria-selected="false">Modificar</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="eliminar-tab" data-bs-toggle="tab" data-bs-target="#eliminar" type="button" role="tab" aria-controls="eliminar" aria-selected="false">Eliminar</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="buscar-tab" data-bs-toggle="tab" data-bs-target="#buscar" type="button" role="tab" aria-controls="buscar" aria-selected="false">Buscar</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="Multioperaciones-tab" data-bs-toggle="tab" data-bs-target="#Multioperaciones" type="button" role="tab" aria-controls="Multioperaciones" aria-selected="false">Multioperaciones</button>
                        </li>
                    </ul>
                </nav>
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="registro" role="tabpanel" aria-labelledby="registro-tab">
                        <form id="divaly-form" class="mt-3">
                            <div class="page active" id="page1">
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">ESPECIFICACIONES</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="codCliente" class="form-label">COD CLIENTE:</label>
                                            <input type="text" class="form-control" id="codCliente" name="codCliente" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label for="nombreDni" class="form-label">NOMBRE/DNI:</label>
                                            <input type="text" class="form-control" id="nombreDni" name="nombreDni" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="detalles" class="form-label">DETALLES:</label>
                                            <input type="text" class="form-control" id="detalles" name="detalles">
                                        </div>
                                        <div class="mb-3">
                                            <label for="fecha" class="form-label">FECHA:</label>
                                            <input type="text" class="form-control" id="fecha" name="fecha" readonly>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary w-100" onclick="nextPage()">Siguiente</button>
                            </div>

                            <div class="page" id="page2">
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">OPERACIONES</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="encargado" class="form-label">ENCARGADO:</label>
                                            <input type="text" class="form-control" id="encargado" name="encargado" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="tipoOperacion" class="form-label">TIPO DE OPERACIÓN:</label>
                                            <select class="form-select" id="tipoOperacion" name="tipoOperacion" required>
                                                <option value="">Seleccione...</option>
                                                <option value="Deposito">Depósito</option>
                                                <option value="Retiro">Retiro</option>
                                                <option value="Pago Recaudo">Pago Recaudo</option>
                                                <option value="Pago Nacional">Pago Nacional</option>
                                                <option value="Compra Producto">Compra Producto</option>
                                                <option value="Copias">Copias</option>
                                                <option value="Adicionales...">Adicionales...</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="entidad" class="form-label">ENTIDAD:</label>
                                            <select class="form-select" id="entidad" name="entidad" required>
                                                <option value="">Seleccione...</option>                                                
                                                <option value="Banco BBVA">Banco BBVA</option>
                                                <option value="Banco INTERBANK">Banco INTERBANK</option>
                                                <option value="BBVA-01">BBVA-01</option>
                                                <option value="BBVA-02">BBVA-02</option>
                                                <option value="BBVA-03">BBVA-03</option>
                                                <option value="BBVA-04">BBVA-04</option>
                                                <option value="EFECTIVO">EFECTIVO</option>
                                                <option value="INTERBANK-01">INTERBANK-01</option>
                                                <option value="YAPE">YAPE</option>
                                                <option value="PLIN">PLIN</option>
                                                <option value="Tarjeta Credito">Tarjeta Credito</option>
                                                <option value="Tarjeta Debito">Tarjeta Debito</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="montoProducto" class="form-label">MONTO PRODUCTO:</label>
                                            <input type="number" class="form-control" id="montoProducto" name="montoProducto" required step="0.01">
                                        </div>
                                        <div class="mb-3">
                                            <label for="montoDado" class="form-label">MONTO DADO:</label>
                                            <input type="number" class="form-control" id="montoDado" name="montoDado" required step="0.01">
                                        </div>
                                        <div class="mb-3">
                                            <label for="vuelto" class="form-label">VUELTO:</label>
                                            <input type="number" class="form-control" id="vuelto" name="vuelto" readonly step="0.01">
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary w-100 mb-2" onclick="prevPage()">Anterior</button>
                                <button type="submit" class="btn btn-primary w-100 mb-2">AGREGAR REGISTRO</button>
                            </div>
                        </form>
                        <button id="nuevaOperacion" class="btn btn-success w-100 mt-3">Nueva Operación para Cliente Actual</button>
                        <button id="exportExcel" class="btn btn-success w-100 mt-3">Exportar a Excel</button>
                    </div>
                    <div class="tab-pane fade" id="modificar" role="tabpanel" aria-labelledby="modificar-tab">
                        <h3 class="mt-3">Modificar Datos</h3>
                        <div class="mb-3">
                            <label for="selectClienteModificar" class="form-label">Seleccionar Cliente:</label>
                            <select class="form-select" id="selectClienteModificar">
                                <option value="">Seleccione un cliente...</option>
                            </select>
                        </div>
                        <form id="modificar-form">
                            <!-- Los campos del formulario de modificación serán los mismos que el de registro -->
                        </form>
                        <button type="button" id="modificarDatos" class="btn btn-primary w-100 mt-3">Guardar Cambios</button>
                    </div>
                    <div class="tab-pane fade" id="eliminar" role="tabpanel" aria-labelledby="eliminar-tab">
                        <h3 class="mt-3">Eliminar Registro</h3>
                        <div class="mb-3">
                            <label for="selectClienteEliminar" class="form-label">Seleccionar Cliente a Eliminar:</label>
                            <select class="form-select" id="selectClienteEliminar">
                                <option value="">Seleccione un cliente...</option>
                            </select>
                        </div>
                        <button type="button" id="eliminarRegistro" class="btn btn-danger w-100 mt-3">Eliminar Registro</button>
                    </div>
                    <div class="tab-pane fade" id="buscar" role="tabpanel" aria-labelledby="buscar-tab">
                        <h3 class="mt-3">Buscar y Modificar Registro</h3>
                        <div class="mb-3">
                            <label for="buscarCliente" class="form-label">Buscar Cliente:</label>
                            <input type="text" class="form-control" id="buscarCliente" placeholder="Ingrese código o nombre">
                        </div>
                        <button type="button" id="buscarRegistro" class="btn btn-primary w-100 mt-3">Buscar</button>
                        <div id="resultadoBusqueda" class="mt-3"></div>
                    </div>
                    <div class="tab-pane fade" id="Multioperaciones" role="tabpanel" aria-labelledby="Multioperaciones-tab">
                        <h3 class="mt-3">Multioperaciones</h3>
                        <div id="multioperacionesForm">
                            <!-- Aquí se agregarán dinámicamente los campos para múltiples operaciones -->
                        </div>
                        <button type="button" id="agregarOperacion" class="btn btn-primary w-100 mt-3">Agregar Operación</button>
                        <button type="button" id="guardarMultioperaciones" class="btn btn-success w-100 mt-3">Guardar Multioperaciones</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script>
        let currentPage = 1;
        let lastClientId = 0;
        let datos = JSON.parse(localStorage.getItem('datosExcel')) || [];
        let currentClientId = null;

        function nextPage() {
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage++;
            document.getElementById(`page${currentPage}`).classList.add('active');
        }

        function prevPage() {
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage--;
            document.getElementById(`page${currentPage}`).classList.add('active');
        }

        function generateClientId() {
            lastClientId++;
            return `Cli_${String(lastClientId).padStart(5, '0')}`;
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('fecha').value = now.toLocaleString('es-ES', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function calcularVuelto() {
            const montoProducto = parseFloat(document.getElementById('montoProducto').value) || 0;
            const montoDado = parseFloat(document.getElementById('montoDado').value) || 0;
            const vuelto = montoDado - montoProducto;
            document.getElementById('vuelto').value = vuelto.toFixed(2);
        }

        function actualizarSelectClientes() {
            const selectModificar = document.getElementById('selectClienteModificar');
            const selectEliminar = document.getElementById('selectClienteEliminar');
            selectModificar.innerHTML = '<option value="">Seleccione un cliente...</option>';
            selectEliminar.innerHTML = '<option value="">Seleccione un cliente...</option>';
            datos.forEach(dato => {
                const option = document.createElement('option');
                option.value = dato.codCliente;
                option.textContent = `${dato.codCliente} - ${dato.nombreDni}`;
                selectModificar.appendChild(option.cloneNode(true));
                selectEliminar.appendChild(option);
            });
        }

        function resetForm() {
            const form = document.getElementById('divaly-form');
            form.reset();
            updateDateTime();
            currentClientId = generateClientId();
            document.getElementById('codCliente').value = currentClientId;
            currentPage = 1;
            document.getElementById('page1').classList.add('active');
            document.getElementById('page2').classList.remove('active');
        }

        function agregarOperacionMulti() {
            const multioperacionesForm = document.getElementById('multioperacionesForm');
            const operacionDiv = document.createElement('div');
            operacionDiv.className = 'card mb-3';
            operacionDiv.innerHTML = `
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Tipo de Operación:</label>
                        <select class="form-select tipoOperacion" required>
                            <option value="">Seleccione...</option>
                            <option value="Deposito">Depósito</option>
                            <option value="Retiro">Retiro</option>
                            <option value="Pago Recaudo">Pago Recaudo</option>
                            <option value="Pago Nacional">Pago Nacional</option>
                            <option value="Compra Producto">Compra Producto</option>
                            <option value="Copias">Copias</option>
                            <option value="Adicionales...">Adicionales...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Entidad:</label>
                        <select class="form-select entidad" required>
                            <option value="">Seleccione...</option>
                            <option value="Banco BBVA">Banco BBVA</option>
                            <option value="Banco INTERBANK">Banco INTERBANK</option>
                            <option value="BBVA-01">BBVA-01</option>
                            <option value="BBVA-02">BBVA-02</option>
                            <option value="BBVA-03">BBVA-03</option>
                            <option value="BBVA-04">BBVA-04</option>
                            <option value="EFECTIVO">EFECTIVO</option>
                            <option value="INTERBANK-01">INTERBANK-01</option>
                            <option value="YAPE">YAPE</option>
                            <option value="PLIN">PLIN</option>
                            <option value="Tarjeta Credito">Tarjeta Credito</option>
                            <option value="Tarjeta Debito">Tarjeta Debito</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Monto:</label>
                        <input type="number" class="form-control monto" required step="0.01">
                    </div>
                    <button type="button" class="btn btn-danger btn-sm eliminarOperacion">Eliminar</button>
                </div>
            `;
            multioperacionesForm.appendChild(operacionDiv);

            operacionDiv.querySelector('.eliminarOperacion').addEventListener('click', function() {
                multioperacionesForm.removeChild(operacionDiv);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            resetForm();
            actualizarSelectClientes();

            const form = document.getElementById('divaly-form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (form.checkValidity()) {
                    const newData = {
                        codCliente: document.getElementById('codCliente').value,
                        nombreDni: document.getElementById('nombreDni').value,
                        detalles: document.getElementById('detalles').value,
                        fecha: document.getElementById('fecha').value,
                        encargado: document.getElementById('encargado').value,
                        tipoOperacion: document.getElementById('tipoOperacion').value,
                        entidad: document.getElementById('entidad').value,
                        montoProducto: document.getElementById('montoProducto').value,
                        montoDado: document.getElementById('montoDado').value,
                        vuelto: document.getElementById('vuelto').value
                        
                    };
                    
                    datos.push(newData);
                    localStorage.setItem('datosExcel', JSON.stringify(datos));
                    // Al final del bloque de envío
                    actualizarGestionCaja(newData);
                    Swal.fire({
                        
                        title: '¡Éxito!',
                        text: 'Los datos se han guardado correctamente.',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            resetForm();
                            actualizarSelectClientes();
                        }
                    });
                } else {
                    form.reportValidity();
                }
            });
            function actualizarGestionCaja(data) {
    const ingresos = parseFloat(data.montoProducto) > 0 ? parseFloat(data.montoProducto) : 0;
    const egresos = parseFloat(data.montoProducto) < 0 ? Math.abs(parseFloat(data.montoProducto)) : 0;

    // Sumar a los totales existentes
    document.getElementById('ingresos').value = (parseFloat(document.getElementById('ingresos').value) + ingresos).toFixed(2);
    document.getElementById('egresos').value = (parseFloat(document.getElementById('egresos').value) + egresos).toFixed(2);
    actualizarTotales(); // Recalcular totales
}

            document.getElementById('montoProducto').addEventListener('input', calcularVuelto);
            document.getElementById('montoDado').addEventListener('input', calcularVuelto);

            document.getElementById('exportExcel').addEventListener('click', function() {
    Swal.fire({
        title: 'Nombre del archivo',
        input: 'text',
        inputAttributes: {
            autocapitalize: 'off'
        },
        showCancelButton: true,
        confirmButtonText: 'Guardar',
        showLoaderOnConfirm: true,
        preConfirm: (fileName) => {
            if (!fileName) {
                Swal.showValidationMessage('Por favor, ingrese un nombre de archivo');
            }
            return fileName;
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const formattedData = datos.map(dato => {
                const formattedDato = { ...dato };
                if (formattedDato.tipoOperacion === 'Retiro') {
                    // Guardar monto como negativo
                    formattedDato.montoProducto = -Math.abs(parseFloat(formattedDato.montoProducto));
                }
                return formattedDato;
            });

            // Datos de Caja
            const cajaData = {
                ingresos: parseFloat(document.getElementById('ingresos').value),
                egresos: parseFloat(document.getElementById('egresos').value),
                total: parseFloat(document.getElementById('total').value),
            };

            // Crea una hoja para datos de caja
            const wsCaja = XLSX.utils.json_to_sheet([cajaData]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, wsCaja, "Caja");

            const ws = XLSX.utils.json_to_sheet(formattedData);
            XLSX.utils.book_append_sheet(wb, ws, "Datos");

            // Aplicar formato rojo para celdas de retiro
            formattedData.forEach((dato, index) => {
                if (dato.tipoOperacion === 'Retiro') {
                    const cellAddress = `F${index + 2}`; // Ajusta 'H' según la columna donde está el monto
                    ws[cellAddress].s = {
                        fill: {
                            fgColor: { rgb: "FFCCCC" } // Color de fondo rojo claro
                        },
                        font: {
                            color: { rgb: "FF0000" } // Texto rojo
                        }
                    };
                }
            });

            // Exportar todo
            XLSX.writeFile(wb, `${result.value}.xlsx`);

            Swal.fire('¡Guardado!', 'El archivo Excel ha sido creado con todos los registros.', 'success');
        }
    });
});
            document.getElementById('nuevaOperacion').addEventListener('click', function() {
                if (currentClientId) {
                    document.getElementById('codCliente').value = currentClientId;
                    document.getElementById('nombreDni').readOnly = true;
                    document.getElementById('detalles').readOnly = true;
                    nextPage();
                } else {
                    Swal.fire('Error', 'No hay un cliente actual seleccionado.', 'error');
                }
            });

            document.getElementById('selectClienteModificar').addEventListener('change', function() {
                const selectedClientId = this.value;
                const clientData = datos.find(dato => dato.codCliente === selectedClientId);
                if (clientData) {
                    const form = document.getElementById('modificar-form');
                    form.innerHTML = '';
                    Object.keys(clientData).forEach(key => {
                        const div = document.createElement('div');
                        div.className = 'mb-3';
                        const label = document.createElement('label');
                        label.className = 'form-label';
                        label.textContent = key.charAt(0).toUpperCase() + key.slice(1);
                        const input = document.createElement('input');
                        input.className = 'form-control';
                        input.id = 'mod_' + key;
                        input.name = key;
                        input.value = clientData[key];
                        if (key === 'codCliente' || key === 'fecha') {
                            input.readOnly = true;
                        }
                        div.appendChild(label);
                        div.appendChild(input);
                        form.appendChild(div);
                    });
                }
            });

            document.getElementById('modificarDatos').addEventListener('click', function() {
                const selectedClientId = document.getElementById('selectClienteModificar').value;
                if (selectedClientId) {
                    const index = datos.findIndex(dato => dato.codCliente === selectedClientId);
                    if (index !== -1) {
                        Object.keys(datos[index]).forEach(key => {
                            const input = document.getElementById('mod_' + key);
                            if (input) {
                                datos[index][key] = input.value;
                            }
                        });
                        localStorage.setItem('datosExcel', JSON.stringify(datos));
                        Swal.fire('¡Éxito!', 'Los datos del cliente han sido actualizados.', 'success');
                        actualizarSelectClientes();
                    }
                } else {
                    Swal.fire('Error', 'Por favor, seleccione un cliente para modificar.', 'error');
                }
            });

            document.getElementById('eliminarRegistro').addEventListener('click', function() {
                const selectedClientId = document.getElementById('selectClienteEliminar').value;
                if (selectedClientId) {
                    Swal.fire({
                        title: '¿Está seguro?',
                        text: "No podrá revertir esta acción",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Sí, eliminar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            const index = datos.findIndex(dato => dato.codCliente === selectedClientId);
                            if (index !== -1) {
                                datos.splice(index, 1);
                                localStorage.setItem('datosExcel', JSON.stringify(datos));
                                Swal.fire('Eliminado', 'El registro ha sido eliminado.', 'success');
                                actualizarSelectClientes();
                            }
                        }
                    });
                } else {
                    Swal.fire('Error', 'Por favor, seleccione un cliente para eliminar.', 'error');
                }
            });

            document.getElementById('buscarRegistro').addEventListener('click', function() {
                const searchTerm = document.getElementById('buscarCliente').value.toLowerCase();
                const resultadoBusqueda = document.getElementById('resultadoBusqueda');
                resultadoBusqueda.innerHTML = '';

                const clientesEncontrados = datos.filter(dato => 
                    dato.codCliente.toLowerCase().includes(searchTerm) || 
                    dato.nombreDni.toLowerCase().includes(searchTerm)
                );

                if (clientesEncontrados.length > 0) {
                    const table = document.createElement('table');
                    table.className = 'table table-striped';
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Nombre/DNI</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    `;
                    clientesEncontrados.forEach(cliente => {
                        const row = table.insertRow();
                        row.innerHTML = `
                            <td>${cliente.codCliente}</td>
                            <td>${cliente.nombreDni}</td>
                            <td><button class="btn btn-primary btn-sm editarCliente" data-id="${cliente.codCliente}">Editar</button></td>
                        `;
                    });
                    resultadoBusqueda.appendChild(table);

                    document.querySelectorAll('.editarCliente').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const clientId = this.getAttribute('data-id');
                            document.getElementById('selectClienteModificar').value = clientId;
                            document.getElementById('selectClienteModificar').dispatchEvent(new Event('change'));
                            document.getElementById('modificar-tab').click();
                        });
                    });
                } else {
                    resultadoBusqueda.innerHTML = '<p>No se encontraron resultados.</p>';
                }
            });

            document.getElementById('agregarOperacion').addEventListener('click', agregarOperacionMulti);

            document.getElementById('guardarMultioperaciones').addEventListener('click', function() {
                const operaciones = document.querySelectorAll('#multioperacionesForm .card');
                const multioperacionesData = [];

                operaciones.forEach((op, index) => {
                    const tipoOperacion = op.querySelector('.tipoOperacion').value;
                    const entidad = op.querySelector('.entidad').value;
                    const monto = op.querySelector('.monto').value;

                    if (tipoOperacion && entidad && monto) {
                        multioperacionesData.push({
                            codCliente: currentClientId || generateClientId(),
                            nombreDni: document.getElementById('nombreDni').value,
                            detalles: `Multioperación ${index + 1}`,
                            fecha: new Date().toLocaleString('es-ES'),
                            encargado: document.getElementById('encargado').value,
                            tipoOperacion: tipoOperacion,
                            entidad: entidad,
                            montoProducto: monto,
                            montoDado: monto,
                            vuelto: '0.00'
                        });
                    }
                });

                if (multioperacionesData.length > 0) {
                    datos = datos.concat(multioperacionesData);
                    localStorage.setItem('datosExcel', JSON.stringify(datos));
                    Swal.fire('¡Éxito!', 'Las multioperaciones se han guardado correctamente.', 'success');
                    document.getElementById('multioperacionesForm').innerHTML = '';
                    actualizarSelectClientes();
                } else {
                    Swal.fire('Error', 'No hay operaciones válidas para guardar.', 'error');
                }
            });
        });
    </script>
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Gestión de Caja Editable</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
            .form-control-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.875rem;
                line-height: 1.5;
            }
        </style>
    </head>
    <body>
        <div class="container mt-5">
            <h1 class="text-center mb-4">Gestión de Caja</h1>
            <div class="row">
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-header">Resumen</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Ingresos</label>
                                <input type="number" class="form-control" id="ingresos" step="0.01">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Egresos</label>
                                <input type="number" class="form-control" id="egresos" step="0.01">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Total</label>
                                <input type="number" class="form-control" id="total" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-header">Caja Chica 1</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Total Resumen</label>
                                <input type="number" class="form-control" id="totalResumen" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Billetes</label>
                                <input type="number" class="form-control" id="billetes" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Total</label>
                                <input type="number" class="form-control" id="totalCajaChica" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-header">Billetes / Monedas</div>
                        <div class="card-body">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Denominación</th>
                                        <th>Cantidad</th>
                                        <th>Total S/</th>
                                    </tr>
                                </thead>
                                <tbody id="billetesMonedasBody">
                                    <!-- Filas generadas dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header">Para Retiro Banco</div>
                        <div class="card-body">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Denominación</th>
                                        <th>Cantidad</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="retiroBancoBody">
                                    <!-- Filas generadas dinámicamente -->
                                </tbody>
                            </table>
                            <div class="mb-3">
                                <label class="form-label">Total Retiro Caja</label>
                                <input type="number" class="form-control" id="totalRetiroCaja" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header">Para Caja Chica</div>
                        <div class="card-body">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Denominación</th>
                                        <th>Cantidad</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="cajaChicaBody">
                                    <!-- Filas generadas dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            const denominaciones = [200, 100, 50, 20, 10, 5, 2, 1, 0.5, 0.2, 0.1];
            let billetesMonedasData = [
                {denominacion: 200, cantidad: 0},
                {denominacion: 100, cantidad: 93},
                {denominacion: 50, cantidad: 108},
                {denominacion: 20, cantidad: 27},
                {denominacion: 10, cantidad: 1},
                {denominacion: 5, cantidad: 1},
                {denominacion: 2, cantidad: 54},
                {denominacion: 1, cantidad: 74},
                {denominacion: 0.5, cantidad: 89},
                {denominacion: 0.2, cantidad: 246},
                {denominacion: 0.1, cantidad: 521}
            ];
    
            let retiroBancoData = [
                {denominacion: 200, cantidad: 0},
                {denominacion: 100, cantidad: 84},
                {denominacion: 50, cantidad: 100},
                {denominacion: 20, cantidad: 17},
                {denominacion: 10, cantidad: 1}
            ];
    
            let cajaChicaData = [
                {denominacion: 200, cantidad: 0},
                {denominacion: 100, cantidad: 9},
                {denominacion: 50, cantidad: 8},
                {denominacion: 20, cantidad: 10},
                {denominacion: 10, cantidad: 0}
            ];
    
            function actualizarTabla(tableId, data) {
                const tbody = document.getElementById(tableId);
                tbody.innerHTML = '';
                let total = 0;
                data.forEach((item, index) => {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = item.denominacion.toFixed(2);
                    const cantidadInput = document.createElement('input');
                    cantidadInput.type = 'number';
                    cantidadInput.className = 'form-control form-control-sm';
                    cantidadInput.value = item.cantidad;
                    cantidadInput.min = 0;
                    cantidadInput.addEventListener('input', (e) => {
                        data[index].cantidad = parseInt(e.target.value) || 0;
                        actualizarTotales();
                    });
                    row.insertCell(1).appendChild(cantidadInput);
                    const subtotal = item.denominacion * item.cantidad;
                    row.insertCell(2).textContent = subtotal.toFixed(2);
                    total += subtotal;
                });
                return total;
            }
    
            function actualizarTotales() {
                const totalBilletesMonedas = actualizarTabla('billetesMonedasBody', billetesMonedasData);
                const totalRetiroBanco = actualizarTabla('retiroBancoBody', retiroBancoData);
                const totalCajaChica = actualizarTabla('cajaChicaBody', cajaChicaData);
    
                document.getElementById('billetes').value = totalBilletesMonedas.toFixed(2);
                document.getElementById('totalRetiroCaja').value = totalRetiroBanco.toFixed(2);
    
                const ingresos = parseFloat(document.getElementById('ingresos').value) || 0;
                const egresos = parseFloat(document.getElementById('egresos').value) || 0;
                const total = ingresos - egresos;
    
                document.getElementById('total').value = total.toFixed(2);
                document.getElementById('totalResumen').value = total.toFixed(2);
                document.getElementById('totalCajaChica').value = (total - totalBilletesMonedas).toFixed(2);
            }
    
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('ingresos').value = 18016.40;
                document.getElementById('egresos').value = 2433.60;
                
                document.getElementById('ingresos').addEventListener('input', actualizarTotales);
                document.getElementById('egresos').addEventListener('input', actualizarTotales);
    
                actualizarTotales();
            });

            
        </script>
    </body>
    </html>
</body>
</html>